<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Shortener & Analytics</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div id="app" class="container mt-5">
        <div class="card shadow p-4">
            <h1 class="text-center mb-4">üîó URL shortener</h1>
            
            <div class="input-group mb-3">
                <input type="text" v-model="urlToShorten" class="form-control" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –¥–ª–∏–Ω–Ω—É—é —Å—Å—ã–ª–∫—É —Å—é–¥–∞...">
                <button class="btn btn-primary" @click="shortenUrl">Reduce</button>
            </div>

            <div v-if="resultUrl" class="alert alert-success">
                –ì–æ—Ç–æ–≤–æ! –¢–≤–æ—è —Å—Å—ã–ª–∫–∞: <a :href="resultUrl" target="_blank">{{ resultUrl }}</a>
                <br>
                <small class="text-muted">Code: {{ shortCode }}</small>
            </div>

            <hr class="my-4">

            <h3>üìä Analytics (Redis)</h3>
            <div class="input-group mb-3">
                <input type="text" v-model="codeToCheck" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ —Å—Å—ã–ª–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, XyZ123)">
                <button class="btn btn-secondary" @click="checkStats">Check clicks</button>
            </div>

            <div v-if="stats" class="alert alert-info">
                <p><strong>Original:</strong> {{ stats.original_url }}</p>
                <p><strong>Clicks:</strong> {{ stats.clicks }}</p>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    urlToShorten: '',
                    resultUrl: '',
                    shortCode: '',
                    codeToCheck: '',
                    stats: null
                }
            },
            methods: {
                async shortenUrl() {
                    if (!this.urlToShorten) return;
                    try {
                        const response = await fetch('http://localhost:5000/shorten', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ url: this.urlToShorten })
                        });
                        const data = await response.json();
                        this.resultUrl = data.full_short_url;
                        this.shortCode = data.short_code;
                    } catch (e) {
                        alert('Error connecting to the server');
                    }
                },
                async checkStats() {
                    if (!this.codeToCheck) return;
                    try {
                        const response = await fetch(`http://localhost:5000/stats/${this.codeToCheck}`);
                        if (response.ok) {
                            this.stats = await response.json();
                        } else {
                            alert('Link not found');
                            this.stats = null;
                        }
                    } catch (e) {
                        alert('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏');
                    }
                }
            }
        }).mount('#app')
    </script>
</body>
</html>